<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="../static/js/detail.js"></script>
<meta charset="UTF-8">
<title>ç›£æŸ»ãƒ­ã‚°</title>
</head>
<body>
	<h2>ç›£æŸ»ãƒ­ã‚°</h2>
	
	<a th:href="@{/expenses/list}">æˆ»ã‚‹</a>
	<div th:if="${error}">
		<p th:text="${error}"></p>
	</div>

	<h3 class="m-3">ç›£æŸ»ãƒ­ã‚°æƒ…å ±</h3>
		<table class="table table-striped align-middle">
			<thead>
				<tr>
					<th>actorId</th>
					<th>createdAt</th>
					<th>action</th>
					<th>before â†’ after</th>
					<th>note</th>
					<th>traceId</th>
				</tr>
			</thead>
			<tbody>
				<tr th:if="${expenseLogs}" th:each="log : ${expenseLogs}">
					<td th:text="${log.actorId}"></td>
					<td th:text="${#temporals.format(log.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
					<td th:text="${log.action}"></td>
					<td>
						
						<p class="badge" 
						th:classappend="${log.beforeStatus == 'APPROVED'} ? 'bg-success' : 
											(${log.beforeStatus == 'SUBMITTED'} ? 'bg-danger' : 
											(${log.beforeStatus == 'REJECTED'} ? 'bg-warning text-dark' : 'bg-secondary'))"
						th:text="${log.beforeStatus} ? ${log.beforeStatus} : 'ã€€ã€€ã€€'">
						</p> â†’ 
						<p class="badge"
						th:classappend="${log.afterStatus == 'APPROVED'} ? 'bg-success' : 
											(${log.afterStatus == 'SUBMITTED'} ? 'bg-danger' : 
											(${log.afterStatus == 'REJECTED'} ? 'bg-warning text-dark' : 'bg-secondary'))" 
						th:text="${log.afterStatus}"></p>
					
					</td>
					<td th:text="${log.note}"></td>
					<td>
						<span th:text="${#strings.substring(log.traceId, 0, 8)}
							+ '...' 
							+ ${#strings.substring(log.traceId, log.traceId.length()-4)}"
							
							
							th:title="${log.traceId}">
						 </span>
						 <button type="button" class="btn btn-sm btn-outline-secondary ms-1"
						 th:attr="data-traceid=${log.traceId}"
						 onclick="copyTraceId(this)">
						 ğŸ“‹
						 </button>
					</td>
				</tr>
			</tbody>
		</table>
		<script>
			function copyTraceId(button) {
				const traceId = button.getAttribute("data-traceid");
				
				navigator.clipboard.writeText(traceId)
				.then(() => {
					button.textContent = "â˜‘";
					setTimeout(() => button.textContent = "ğŸ“‹", 800);
				})
				.catch(() => {
					alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
				});
			}
	   </script>

</body>
</html>